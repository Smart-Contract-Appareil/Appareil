<!DOCTYPE html>
<html>
    <head>
        <head>
            <meta charset='utf-8'>
            <meta http-equiv='X-UA-Compatible' content='IE=edge'>
            <title>Web 3 Demo</title>
            <meta name='viewport' content='width=device-width, initial-scale=1'>

            <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
            <script type="text/javascript" src="abi.js"></script>
        </head>
    </head>

    <body>

        <h1> Informations de l'appareil </h1>

        
        Catégorie : <span id="categorie">Loading...</span> <br></br>
        Type : <span id="a_type">Loading...</span> <br></br>
        Marque : <span id="marque">Loading...</span> <br></br>
        Référence : <span id="ref">Loading...</span> <br></br>
        N° de série : <span id="nb_serie">Loading...</span> <br></br>
        Statut: <span id="statut">Loading...</span> <br></br>
        <br></br>

        <a href = "changeInfo.html">
            <button>Changer les informations</button>
        </a>
        &nbsp &nbsp &nbsp
        <button onclick = "demande()"> Demander une intervention </button>
        &nbsp &nbsp &nbsp

        <a href = "logIntervention.html"></a>
        <button> Enregistrer des travaux </button>
        </a>
        
        <script type="text/javascript">            
            var contractAddress = '0x5b066594180529EF12ad59C30d5C31A1347fBb02';
            var account = "0x7755414216938522c7dEC813F143dBc0ad6dc84A" ;

            async function loadWeb3() {
                if (window.ethereum) {
                    window.web3 = new Web3(window.ethereum);
                    window.ethereum.enable();
                }
            }    
          
            async function loadContract() {
                return await new window.web3.eth.Contract(ABI, contractAddress);
            }


            async function load() {
                await loadWeb3();
                window.contract = await loadContract();

            }

            load();

            async function demande(){
                console.log("Changing status to 0");
                const status = await window.contract.methods.askIntervention().send({from: account});
            }

        </script>
    </body>

</html>