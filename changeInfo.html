<!DOCTYPE html>
<html>
    <head>
        <head>
            <meta charset='utf-8'>
            <meta http-equiv='X-UA-Compatible' content='IE=edge'>
            <title>Change Appareil Information</title>
            <meta name='viewport' content='width=device-width, initial-scale=1'>

            <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
            <script type="text/javascript" src="abi.js"></script>
            <script src="test.html"></script>
        </head>
    </head>
    <h1>Compléter les informations</h1>

    <form>
        <table>
            <div>
                Catégorie d'appareil : 
                <select name="Categorie" id = "cat_select" class = "custom-select">
                    <option value="">--Choisissez une catégorie--</option>
                    <option value="Froid">Froid</option>
                    <option value="Chaud">Chaud</option>
                    <option value="Climatisation">Climatisation</option>
                </select>
            </div>
            <br></br>
            <div>
                Type d'appareil : 
            <select name="Type" id = "type_select" class = "custom-select">
                <option value="">--Choisissez un type d'appareil--</option>
                <option value="Armoire à température négative">Armoire à température négative</option>
                <option value="Armoire à température positive">Armoire à température positive</option>
                <option value="Cellule de refroidissement">Cellule de refroidissement</option>
                <option value="Grill">Grill</option>
                <option value="Plaques">Plaques</option>
                <option value="Four">Four</option>
                <option value="Chauffe assiettes">Chauffe assiettes</option>
                <option value="Bain Marie">Bain Marie</option>
                <option value="Ventilateur">Ventilateur</option>
            </select>
            </div>
            <br></br>
            <div>
                Marque : 
                <input type="text" id="marque"> </input>
            </div>
            <br></br>
            <div>
                Référence : 
                <input type="text" id="ref"> </input>
            </div>
            <br></br>
            <div>
                N° de série : 
                <input type="text" id="n_serie"> </input>
            </div>
        </table>
    </form>
    <br></br>
    <button onclick = "setInfoAppareil()">Enregistrer les informations</button>
    <a href="test.html"><button onclick = "getInfoAppareil()">Récupérer informations</button></a>

    <script type="text/javascript">
        var contractAddress = '0xDFf05A5D3c2e7680757e35487286378EF95bc59E'; //Adresse contrat déployé
        var account = '0x542b817700C2A772E0DE966673fF6B5D39734677'; //Adresse compte metamask

        async function loadWeb3() {
                if (window.ethereum) {
                    window.web3 = new Web3(window.ethereum);
                    window.ethereum.enable();
                }
            }    
            
        async function loadContract() {
                return await new window.web3.eth.Contract(ABI, contractAddress);
            }

        async function load() {
            await loadWeb3();
            window.contract = await loadContract();
        }

        load();

        async function setInfoAppareil() {
            const cat = document.getElementById('cat_select').value;
            const a_type = document.getElementById('type_select').value;
            const brand = document.getElementById('marque').value;
            const ref = document.getElementById('ref').value;
            const serial_n = document.getElementById('n_serie').value;
             
            console.log("cat =" + cat + ", a_type = " + a_type + ", brand= "+ brand +" ,ref = "+ ref + " ,serial_n = "+ serial_n);
            const Appareil = await window.contract.methods.setAppareil(cat,a_type,brand,ref,serial_n).send({from: account});
        }

        async function getInfoAppareil() {

            const cat1 = window.contract.methods.categorie().call()
            const a_type1 = window.contract.methods.a_type().call()
            const marque1 = window.contract.methods.brand().call()
            const ref1 = window.contract.methods.refer().call()
            const nb_serie1 = window.contract.methods.serial_n().call()
            document.getElementById("categorie").innerHTML = cat1;
            document.getElementById("a_type").innerHTML = a_type1;
            document.getElementById("marque").innerHTML = marque1;
            document.getElementById("ref").innerHTML = ref1;
            document.getElementById("nb_serie").innerHTML = nb_serie1;
}

    </script>

</html>