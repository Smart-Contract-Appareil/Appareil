<!DOCTYPE html>
<html>
    <head>
        <head>
            <meta charset='utf-8'>
            <meta http-equiv='X-UA-Compatible' content='IE=edge'>
            <title>Change Appareil Information</title>
            <meta name='viewport' content='width=device-width, initial-scale=1'>

            <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
            <script type="text/javascript" src="abi.js"></script>
        </head>
    </head>
    <h1>Compléter les informations</h1>

    <form>
        <table>
            <div>
                Catégorie d'appareil : 
                <select name="Categorie" id = "cat_select" class = "custom-select">
                    <option value="">--Choisissez une catégorie--</option>
                    <option value="Froid">Froid</option>
                    <option value="Chaud">Chaud</option>
                    <option value="Climatisation">Climatisation</option>
                </select>
            </div>
            <br></br>
            <div>
                Type d'appareil : 
            <select name="Type" id = "type_select" class = "custom-select">
                <option value="">--Choisissez un type d'appareil--</option>
                <option value="Armoire à température négative">Armoire à température négative</option>
                <option value="Armoire à température positive">Armoire à température positive</option>
                <option value="Cellule de refroidissement">Cellule de refroidissement</option>
                <option value="Grill">Grill</option>
                <option value="Plaques">Plaques</option>
                <option value="Four">Four</option>
                <option value="Chauffe assiettes">Chauffe assiettes</option>
                <option value="Bain Marie">Bain Marie</option>
                <option value="Ventilateur">Ventilateur</option>
            </select>
            </div>
            <br></br>
            <div>
                Marque : 
                <input type="text" id="marque"> </input>
            </div>
            <br></br>
            <div>
                Référence : 
                <input type="text" id="ref"> </input>
            </div>
            <br></br>
            <div>
                N° de série : 
                <input type="text" id="n_serie"> </input>
            </div>
        </table>
    </form>
    <br></br>
    <button onclick = "setInfoAppareil()">Enregistrer les informations</button>

    <script type="text/javascript">
        var contractAddress = '0x5b066594180529EF12ad59C30d5C31A1347fBb02';
        var account = "0x7755414216938522c7dEC813F143dBc0ad6dc84A" ;

        async function loadWeb3() {
                if (window.ethereum) {
                    window.web3 = new Web3(window.ethereum);
                    window.ethereum.enable();
                }
            }    
            
        async function loadContract() {
                return await new window.web3.eth.Contract(ABI, contractAddress);
            }

        async function load() {
            await loadWeb3();
            window.contract = await loadContract();
        }

        load();

        async function setInfoAppareil() {
            const cat = document.getElementById('cat_select').value;
            const a_type = document.getElementById('type_select').value;
            const brand = document.getElementById('marque').value;
            const ref = document.getElementById('ref').value;
            const serial_n = document.getElementById('n_serie').value;
             
            console.log("cat =" + cat + ", a_type = " + a_type + ", brand= "+ brand +" ,ref = "+ ref + " ,serial_n = "+ serial_n);
            const Appareil = await window.contract.methods.setAppareil(cat,a_type,brand,ref,serial_n).send({from: account});
        }

        async function printInfoAppareil() {             
            const Appareil = await window.contract.appareil.call();
            console.log(Appareil);
        }

        async function printCoolNumber() {
                updateStatus('fetching Cool Number...');
                const coolNumber = await window.contract.methods.coolNumber().call();
                updateStatus(`coolNumber: ${coolNumber}`);
            }

    </script>

</html>