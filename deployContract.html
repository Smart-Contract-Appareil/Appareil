<!DOCTYPE html>
<html>
    <head>
       <meta charset="UTF-8">
    <title>Nouvel appareil</title>
    <link rel="stylesheet" href="style_deployContract.css">
    <script src="https://kit.fontawesome.com/b99e675b6e.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/ethereumjs/browser-builds/dist/ethereumjs-tx/ethereumjs-tx-1.3.3.min.js"></script>
    <script type="text/javascript" src="abi2.js"></script>
    <script type="module" src="abi2.js"></script>


  
    </head>
    
    <body>
        
        <div class="wrapper">
            <div class="sidebar">
                <h2>My Repair</h2>
                <ul>
                    <li><a href="profilClient.html"><i class="fas fa-user-circle"></i>Profil client</a></li>
                    <li><a href="deployContract.html"><i class="fas fa-shopping-cart"></i>Nouvel appareil</a></li>
                    <li><a href="infoContrat.html"><i class="fas fa-list-ol"></i>Mes contrats</a></li>
                    
                </ul> 
            
            </div>
        </div>

            <div class="main_content">
                <div class="header">Ajout d'un nouvel appareil</div> 

                <div class="formulaire">
                    <form>
                        <table>
                            <div>
                                Catégorie d'appareil : 
                                <select name="Categorie" id = "cat_select" class = "custom-select" required>
                                    <option value="">--Choisissez une catégorie--</option>
                                    <option value="Froid">Froid</option>
                                    <option value="Chaud">Chaud</option>
                                    <option value="Climatisation">Climatisation</option>
                                </select>
                            </div>
                            <br></br>
                            <div>
                                Type d'appareil : 
                            <select name="Type" id = "type_select" class = "custom-select" required>
                                <option value="">--Choisissez un type d'appareil--</option>
                                <option value="Armoire à température négative">Armoire à température négative</option>
                                <option value="Armoire à température positive">Armoire à température positive</option>
                                <option value="Cellule de refroidissement">Cellule de refroidissement</option>
                                <option value="Grill">Grill</option>
                                <option value="Plaques">Plaques</option>
                                <option value="Four">Four</option>
                                <option value="Chauffe assiettes">Chauffe assiettes</option>
                                <option value="Bain Marie">Bain Marie</option>
                                <option value="Ventilateur">Ventilateur</option>
                            </select>
                            </div>
                            <br></br>
                            <div>
                                Marque : 
                                <input type="text" id="marque" required> </input>
                            </div>
                            <br></br>
                            <div>
                                Référence : 
                                <input type="text" id="ref" required> </input>
                            </div>
                            <br></br>
                            <div>
                                N° de série : 
                                <input type="text" id="n_serie" required> </input>
                            </div>
                        </table>
                    </form>
                    <br><br><br><br>
                    <button onclick = "deployContract()" id = "deploy">Enregistrer les informations</button>

                </form>
                </div>

            </div>
        
            <script type="text/javascript">
                async function loadWeb3() {
                        if (window.ethereum) {
                            window.web3 = new Web3(window.ethereum);
                            window.ethereum.enable();
                        }
                    }    
                    
                async function loadContract(contractAddress) {
                        return await new window.web3.eth.Contract(ABI2, contractAddress);
                    }
        
                async function deployContract() {
                    document.getElementById("deploy").disabled = true;
                    var account = await web3.eth.getAccounts();
                    account = account[0];
                    var whitelistedAddresses = ["0x7755414216938522c7dEC813F143dBc0ad6dc84A","0x542b817700C2A772E0DE966673fF6B5D39734677",
                                        "0x4415FC24cbA9CEC76cCD5ad313aa02363651D3BA","0xC8134fA8C874359e9aa8ECd005aF6a409446a59A"]

                    //Lisa const privateKey1 = new ethereumjs.Buffer.Buffer.from("cf55318043c4b42993590bc9594629e8520f6791a31e6c1d1e3e9d318dd8766c", 'hex');
                    const privateKey1 = new ethereumjs.Buffer.Buffer.from("eb9782c3ef1f1ed3e4e40e57c1922e77da7e35f7ca207cb376991946cd75806a",'hex');
                    //deploye contract
                    web3.eth.getTransactionCount(account,async(err,txCount)=>{
                        //smart contract data 
                        const data = '0x60806040526040518060400160405280600b81526020017f52c3a97061726174696f6e000000000000000000000000000000000000000000815250600c90805190602001906200005192919062000316565b506040518060400160405280600b81526020017f4d61696e74656e616e6365000000000000000000000000000000000000000000815250600d90805190602001906200009f92919062000316565b506040518060400160405280600c81526020017f496e7374616c6c6174696f6e0000000000000000000000000000000000000000815250600e9080519060200190620000ed92919062000316565b506040518060400160405280600c81526020017f4d6f64696669636174696f6e0000000000000000000000000000000000000000815250600f90805190602001906200013b92919062000316565b506040518060400160405280600d81526020017f436174c3a9676f726965203a2000000000000000000000000000000000000000815250601090805190602001906200018992919062000316565b506040518060400160405280601281526020017f54797065206427617070617265696c203a20000000000000000000000000000081525060119080519060200190620001d792919062000316565b506040518060400160405280600981526020017f4d6172717565203a200000000000000000000000000000000000000000000000815250601290805190602001906200022592919062000316565b506040518060400160405280600e81526020017f52c3a966c3a972656e6365203a20000000000000000000000000000000000000815250601390805190602001906200027392919062000316565b506040518060400160405280601481526020017f4e756dc3a9726f2064652073c3a9726965203a2000000000000000000000000081525060149080519060200190620002c192919062000316565b50348015620002cf57600080fd5b50336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550620003bc565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200035957805160ff19168380011785556200038a565b828001600101855582156200038a579182015b82811115620003895782518255916020019190600101906200036c565b5b5090506200039991906200039d565b5090565b5b80821115620003b85760008160009055506001016200039e565b5090565b61346680620003cc6000396000f3fe608060405234801561001057600080fd5b50600436106101425760003560e01c806372c7e48d116100b857806398bf9a5d1161007c57806398bf9a5d14610372578063aa5761ac146103a2578063aacbf88b146103c0578063db31dd17146103de578063e1f97a741461040e578063e6d4d2171461042c57610142565b806372c7e48d146102e05780637d4bab0d146103105780638ae1c4e91461032e5780638da5cb5b1461033857806397f40a3b1461035657610142565b8063359531081161010a57806335953108146102065780634ba4485e14610236578063516d18b3146102525780636342e9201461026e5780636357e3b51461028a5780637213f70c146102c457610142565b80630c3321191461014757806310cfcf86146101775780631106cde4146101955780632ccab98d146101ca5780632d9fff01146101e8575b600080fd5b610161600480360381019061015c91906126e7565b61045c565b60405161016e9190612fb2565b60405180910390f35b61017f61047c565b60405161018c9190612fe8565b60405180910390f35b6101af60048036038101906101aa9190612ba1565b61051a565b6040516101c1969594939291906131e4565b60405180910390f35b6101d26107b6565b6040516101df91906130d8565b60405180910390f35b6101f06107bc565b6040516101fd9190612fe8565b60405180910390f35b610220600480360381019061021b9190612764565b61085a565b60405161022d9190612fb2565b60405180910390f35b610250600480360381019061024b91906129d6565b610932565b005b61026c600480360381019061026791906128e7565b610b29565b005b61028860048036038101906102839190612824565b610f0b565b005b6102a4600480360381019061029f9190612ba1565b611048565b6040516102bb9b9a999897969594939291906130f3565b60405180910390f35b6102de60048036038101906102d991906127d0565b611692565b005b6102fa60048036038101906102f59190612764565b61189b565b6040516103079190612fb2565b60405180910390f35b610318611973565b6040516103259190612fcd565b60405180910390f35b610336611979565b005b610340611a5d565b60405161034d9190612f97565b60405180910390f35b610370600480360381019061036b91906128e7565b611a81565b005b61038c600480360381019061038791906126e7565b611ca4565b6040516103999190612fb2565b60405180910390f35b6103aa611cc4565b6040516103b79190612fe8565b60405180910390f35b6103c8611d62565b6040516103d59190612fe8565b60405180910390f35b6103f860048036038101906103f39190612710565b611e00565b6040516104059190612fb2565b60405180910390f35b610416612117565b6040516104239190612fe8565b60405180910390f35b61044660048036038101906104419190612710565b6121b5565b6040516104539190612fb2565b60405180910390f35b60026020528060005260406000206000915054906101000a900460ff1681565b60078054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156105125780601f106104e757610100808354040283529160200191610512565b820191906000526020600020905b8154815290600101906020018083116104f557829003601f168201915b505050505081565b600a602052806000526040600020600091509050806000015490806001018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156105cc5780601f106105a1576101008083540402835291602001916105cc565b820191906000526020600020905b8154815290600101906020018083116105af57829003601f168201915b505050505090806002015490806003018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156106705780601f1061064557610100808354040283529160200191610670565b820191906000526020600020905b81548152906001019060200180831161065357829003601f168201915b505050505090806004018054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561070e5780601f106106e35761010080835404028352916020019161070e565b820191906000526020600020905b8154815290600101906020018083116106f157829003601f168201915b505050505090806005018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156107ac5780601f10610781576101008083540402835291602001916107ac565b820191906000526020600020905b81548152906001019060200180831161078f57829003601f168201915b5050505050905086565b600b5481565b60058054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156108525780601f1061082757610100808354040283529160200191610852565b820191906000526020600020905b81548152906001019060200180831161083557829003601f168201915b505050505081565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146108eb576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108e2906130b8565b60405180910390fd5b60005b835181101561092b5761091484828151811061090657fe5b602002602001015184611e00565b1561091e57600191505b80806001019150506108ee565b5092915050565b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1661098857600080fd5b604051806101600160405280600b5481526020018b81526020018a81526020018981526020018881526020018781526020018681526020018581526020018481526020018381526020018281525060096000600b548152602001908152602001600020600082015181600001556020820151816001019080519060200190610a119291906124c0565b506040820151816002019080519060200190610a2e9291906124c0565b506060820151816003019080519060200190610a4b9291906124c0565b506080820151816004019080519060200190610a689291906124c0565b5060a0820151816005019080519060200190610a859291906124c0565b5060c0820151816006019080519060200190610aa29291906124c0565b5060e0820151816007019080519060200190610abf9291906124c0565b50610100820151816008019080519060200190610add9291906124c0565b50610120820151816009019080519060200190610afb9291906124c0565b5061014082015181600a019080519060200190610b199291906124c0565b5090505050505050505050505050565b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16610b7f57600080fd5b7fc794ba7309753fe436d45098afb5cd41b757762ba510599b624e1f3f1900d5fe600f604051610baf919061300a565b60405180910390a184604051602001610bc89190612f3f565b604051602081830303815290604052805190602001206003604051602001610bf09190612f56565b6040516020818303038152906040528051906020012014610c49577f14dfb728c47455e2d73b5f4caeeefabeb5ad3f00b72dd26d2ea56b2ba92e49626010600387604051610c409392919061302c565b60405180910390a15b83604051602001610c5a9190612f3f565b604051602081830303815290604052805190602001206004604051602001610c829190612f56565b6040516020818303038152906040528051906020012014610cdb577f14dfb728c47455e2d73b5f4caeeefabeb5ad3f00b72dd26d2ea56b2ba92e49626011600486604051610cd29392919061302c565b60405180910390a15b82604051602001610cec9190612f3f565b604051602081830303815290604052805190602001206005604051602001610d149190612f56565b6040516020818303038152906040528051906020012014610d6d577f14dfb728c47455e2d73b5f4caeeefabeb5ad3f00b72dd26d2ea56b2ba92e49626012600585604051610d649392919061302c565b60405180910390a15b81604051602001610d7e9190612f3f565b604051602081830303815290604052805190602001206006604051602001610da69190612f56565b6040516020818303038152906040528051906020012014610dff577f14dfb728c47455e2d73b5f4caeeefabeb5ad3f00b72dd26d2ea56b2ba92e49626013600684604051610df69392919061302c565b60405180910390a15b80604051602001610e109190612f3f565b604051602081830303815290604052805190602001206007604051602001610e389190612f56565b6040516020818303038152906040528051906020012014610e91577f14dfb728c47455e2d73b5f4caeeefabeb5ad3f00b72dd26d2ea56b2ba92e49626014600783604051610e889392919061302c565b60405180910390a15b8460039080519060200190610ea79291906124c0565b508360049080519060200190610ebe9291906124c0565b508260059080519060200190610ed59291906124c0565b508160069080519060200190610eec9291906124c0565b508060079080519060200190610f039291906124c0565b505050505050565b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16610f6157600080fd5b600b600081548092919060010191905055506040518060c00160405280600b54815260200185815260200142815260200184815260200183815260200182815250600a6000600b548152602001908152602001600020600082015181600001556020820151816001019080519060200190610fdd9291906124c0565b506040820151816002015560608201518160030190805190602001906110049291906124c0565b5060808201518160040190805190602001906110219291906124c0565b5060a082015181600501908051906020019061103e9291906124c0565b5090505050505050565b6009602052806000526040600020600091509050806000015490806001018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156110fa5780601f106110cf576101008083540402835291602001916110fa565b820191906000526020600020905b8154815290600101906020018083116110dd57829003601f168201915b505050505090806002018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156111985780601f1061116d57610100808354040283529160200191611198565b820191906000526020600020905b81548152906001019060200180831161117b57829003601f168201915b505050505090806003018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156112365780601f1061120b57610100808354040283529160200191611236565b820191906000526020600020905b81548152906001019060200180831161121957829003601f168201915b505050505090806004018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156112d45780601f106112a9576101008083540402835291602001916112d4565b820191906000526020600020905b8154815290600101906020018083116112b757829003601f168201915b505050505090806005018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156113725780601f1061134757610100808354040283529160200191611372565b820191906000526020600020905b81548152906001019060200180831161135557829003601f168201915b505050505090806006018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156114105780601f106113e557610100808354040283529160200191611410565b820191906000526020600020905b8154815290600101906020018083116113f357829003601f168201915b505050505090806007018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156114ae5780601f10611483576101008083540402835291602001916114ae565b820191906000526020600020905b81548152906001019060200180831161149157829003601f168201915b505050505090806008018054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561154c5780601f106115215761010080835404028352916020019161154c565b820191906000526020600020905b81548152906001019060200180831161152f57829003601f168201915b505050505090806009018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156115ea5780601f106115bf576101008083540402835291602001916115ea565b820191906000526020600020905b8154815290600101906020018083116115cd57829003601f168201915b50505050509080600a018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156116885780601f1061165d57610100808354040283529160200191611688565b820191906000526020600020905b81548152906001019060200180831161166b57829003601f168201915b505050505090508b565b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff166116e857600080fd5b6001821315801561171957507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8212155b1561185c5760006008541415611766577fc794ba7309753fe436d45098afb5cd41b757762ba510599b624e1f3f1900d5fe600c604051611759919061300a565b60405180910390a16117ab565b600160085414156117aa577fc794ba7309753fe436d45098afb5cd41b757762ba510599b624e1f3f1900d5fe600d6040516117a1919061300a565b60405180910390a15b5b81600854146117f357816008819055507f7a00920a8ba8e5694e15f7e7f7affffafadb681ece377a861668ff39030fa621826040516117ea9190612fcd565b60405180910390a15b60005b8151811015611856577fc794ba7309753fe436d45098afb5cd41b757762ba510599b624e1f3f1900d5fe82828151811061182c57fe5b60200260200101516040516118419190612fe8565b60405180910390a180806001019150506117f6565b50611897565b6040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161188e90613078565b60405180910390fd5b5050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461192c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611923906130b8565b60405180910390fd5b60005b835181101561196c5761195584828151811061194757fe5b6020026020010151846121b5565b1561195f57600191505b808060010191505061192f565b5092915050565b60085481565b600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff166119cf57600080fd5b60016008541415611a205760006008819055507f7a00920a8ba8e5694e15f7e7f7affffafadb681ece377a861668ff39030fa621600854604051611a139190612fcd565b60405180910390a1611a5b565b6040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611a5290613098565b60405180910390fd5b565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16611ad757600080fd5b7fc794ba7309753fe436d45098afb5cd41b757762ba510599b624e1f3f1900d5fe600e604051611b07919061300a565b60405180910390a17fc794ba7309753fe436d45098afb5cd41b757762ba510599b624e1f3f1900d5fe85604051611b3e9190612fe8565b60405180910390a17fc794ba7309753fe436d45098afb5cd41b757762ba510599b624e1f3f1900d5fe84604051611b759190612fe8565b60405180910390a17fc794ba7309753fe436d45098afb5cd41b757762ba510599b624e1f3f1900d5fe83604051611bac9190612fe8565b60405180910390a17fc794ba7309753fe436d45098afb5cd41b757762ba510599b624e1f3f1900d5fe82604051611be39190612fe8565b60405180910390a17fc794ba7309753fe436d45098afb5cd41b757762ba510599b624e1f3f1900d5fe81604051611c1a9190612fe8565b60405180910390a18460039080519060200190611c389291906124c0565b508360049080519060200190611c4f9291906124c0565b508260059080519060200190611c669291906124c0565b508160069080519060200190611c7d9291906124c0565b508060079080519060200190611c949291906124c0565b5060016008819055505050505050565b60016020528060005260406000206000915054906101000a900460ff1681565b60038054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611d5a5780601f10611d2f57610100808354040283529160200191611d5a565b820191906000526020600020905b815481529060010190602001808311611d3d57829003601f168201915b505050505081565b60068054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611df85780601f10611dcd57610100808354040283529160200191611df8565b820191906000526020600020905b815481529060010190602001808311611ddb57829003601f168201915b505050505081565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611e91576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611e88906130b8565b60405180910390fd5b604051602001611ea090612f6d565b6040516020818303038152906040528051906020012082604051602001611ec79190612f3f565b604051602081830303815290604052805190602001201415611fce57600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1615611fc9576000600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055507f08d57f893c6ec4bc04c3c651ab22e344730d1ed72af9ecd7372087e6bec5543483604051611fbc9190612f97565b60405180910390a1600190505b612111565b604051602001611fdd90612f82565b60405160208183030381529060405280519060200120826040516020016120049190612f3f565b60405160208183030381529060405280519060200120141561210b57600260008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1615612106576000600260008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055507fdacfc11515e594e016ca1ecac75a938ee2d3ff265fa9d3c48d082c68c2e15ed2836040516120f99190612f97565b60405180910390a1600190505b612110565b600090505b5b92915050565b60048054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156121ad5780601f10612182576101008083540402835291602001916121ad565b820191906000526020600020905b81548152906001019060200180831161219057829003601f168201915b505050505081565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614612246576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161223d906130b8565b60405180910390fd5b60405160200161225590612f6d565b604051602081830303815290604052805190602001208260405160200161227c9190612f3f565b60405160208183030381529060405280519060200120141561238157600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1661237c5760018060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055507f9046ad459158063b4463db7c78236bb00abdcf44d8cc1310eb1b99a2d035ba298360405161236f9190612f97565b60405180910390a1600190505b6124ba565b60405160200161239090612f82565b60405160208183030381529060405280519060200120826040516020016123b79190612f3f565b6040516020818303038152906040528051906020012014156124b957600260008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff166124b8576001600260008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055507f4741c5511fc437c24855318d451aae826bd116cd86820e6edac58574673aaff1836040516124ab9190612f97565b60405180910390a1600190505b5b5b92915050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061250157805160ff191683800117855561252f565b8280016001018555821561252f579182015b8281111561252e578251825591602001919060010190612513565b5b50905061253c9190612540565b5090565b5b80821115612559576000816000905550600101612541565b5090565b60008135905061256c816133eb565b92915050565b600082601f83011261258357600080fd5b81356125966125918261328e565b613261565b915081818352602084019350602081019050838560208402820111156125bb57600080fd5b60005b838110156125eb57816125d1888261255d565b8452602084019350602083019250506001810190506125be565b5050505092915050565b600082601f83011261260657600080fd5b8135612619612614826132b6565b613261565b9150818183526020840193506020810190508360005b8381101561265f5781358601612645888261267e565b84526020840193506020830192505060018101905061262f565b5050505092915050565b60008135905061267881613402565b92915050565b600082601f83011261268f57600080fd5b81356126a261269d826132de565b613261565b915080825260208301602083018583830111156126be57600080fd5b6126c9838284613398565b50505092915050565b6000813590506126e181613419565b92915050565b6000602082840312156126f957600080fd5b60006127078482850161255d565b91505092915050565b6000806040838503121561272357600080fd5b60006127318582860161255d565b925050602083013567ffffffffffffffff81111561274e57600080fd5b61275a8582860161267e565b9150509250929050565b6000806040838503121561277757600080fd5b600083013567ffffffffffffffff81111561279157600080fd5b61279d85828601612572565b925050602083013567ffffffffffffffff8111156127ba57600080fd5b6127c68582860161267e565b9150509250929050565b600080604083850312156127e357600080fd5b60006127f185828601612669565b925050602083013567ffffffffffffffff81111561280e57600080fd5b61281a858286016125f5565b9150509250929050565b6000806000806080858703121561283a57600080fd5b600085013567ffffffffffffffff81111561285457600080fd5b6128608782880161267e565b945050602085013567ffffffffffffffff81111561287d57600080fd5b6128898782880161267e565b935050604085013567ffffffffffffffff8111156128a657600080fd5b6128b28782880161267e565b925050606085013567ffffffffffffffff8111156128cf57600080fd5b6128db8782880161267e565b91505092959194509250565b600080600080600060a086880312156128ff57600080fd5b600086013567ffffffffffffffff81111561291957600080fd5b6129258882890161267e565b955050602086013567ffffffffffffffff81111561294257600080fd5b61294e8882890161267e565b945050604086013567ffffffffffffffff81111561296b57600080fd5b6129778882890161267e565b935050606086013567ffffffffffffffff81111561299457600080fd5b6129a08882890161267e565b925050608086013567ffffffffffffffff8111156129bd57600080fd5b6129c98882890161267e565b9150509295509295909350565b6000806000806000806000806000806101408b8d0312156129f657600080fd5b60008b013567ffffffffffffffff811115612a1057600080fd5b612a1c8d828e0161267e565b9a505060208b013567ffffffffffffffff811115612a3957600080fd5b612a458d828e0161267e565b99505060408b013567ffffffffffffffff811115612a6257600080fd5b612a6e8d828e0161267e565b98505060608b013567ffffffffffffffff811115612a8b57600080fd5b612a978d828e0161267e565b97505060808b013567ffffffffffffffff811115612ab457600080fd5b612ac08d828e0161267e565b96505060a08b013567ffffffffffffffff811115612add57600080fd5b612ae98d828e0161267e565b95505060c08b013567ffffffffffffffff811115612b0657600080fd5b612b128d828e0161267e565b94505060e08b013567ffffffffffffffff811115612b2f57600080fd5b612b3b8d828e0161267e565b9350506101008b013567ffffffffffffffff811115612b5957600080fd5b612b658d828e0161267e565b9250506101208b013567ffffffffffffffff811115612b8357600080fd5b612b8f8d828e0161267e565b9150509295989b9194979a5092959850565b600060208284031215612bb357600080fd5b6000612bc1848285016126d2565b91505092915050565b612bd381613346565b82525050565b612be281613358565b82525050565b612bf181613364565b82525050565b6000612c028261331f565b612c0c818561332a565b9350612c1c8185602086016133a7565b612c25816133da565b840191505092915050565b6000612c3b8261331f565b612c45818561333b565b9350612c558185602086016133a7565b80840191505092915050565b600081546001811660008114612c7e5760018114612ca457612ce8565b607f6002830416612c8f818761332a565b955060ff198316865260208601935050612ce8565b60028204612cb2818761332a565b9550612cbd8561330a565b60005b82811015612cdf57815481890152600182019150602081019050612cc0565b80880195505050505b505092915050565b600081546001811660008114612d0d5760018114612d3257612d76565b607f6002830416612d1e818761333b565b955060ff1983168652808601935050612d76565b60028204612d40818761333b565b9550612d4b8561330a565b60005b82811015612d6d57815481890152600182019150602081019050612d4e565b82880195505050505b505092915050565b6000612d8b600b8361333b565b91507f746563686e696369616e730000000000000000000000000000000000000000006000830152600b82019050919050565b6000612dcb603c8361332a565b91507f6e6577537461747573206d757374206265202d31202864656164292c2030202860008301527f6f7574206f66206f7264657229206f7220312028776f726b696e6729000000006020830152604082019050919050565b6000612e3160068361333b565b91507f636c69656e7400000000000000000000000000000000000000000000000000006000830152600682019050919050565b6000612e71604e8361332a565b91507f556e652064656d616e6465206427696e74657276656e74696f6e20612064c3a960008301527f6ac3a020c3a974c3a92065666665637475c3a965202f2050617320642761707060208301527f617265696c206578697374616e740000000000000000000000000000000000006040830152606082019050919050565b6000612efd60188361332a565b91507f4e6f7420617574686f72697a6564206f7065726174696f6e00000000000000006000830152602082019050919050565b612f398161338e565b82525050565b6000612f4b8284612c30565b915081905092915050565b6000612f628284612cf0565b915081905092915050565b6000612f7882612d7e565b9150819050919050565b6000612f8d82612e24565b9150819050919050565b6000602082019050612fac6000830184612bca565b92915050565b6000602082019050612fc76000830184612bd9565b92915050565b6000602082019050612fe26000830184612be8565b92915050565b600060208201905081810360008301526130028184612bf7565b905092915050565b600060208201905081810360008301526130248184612c61565b905092915050565b600060608201905081810360008301526130468186612c61565b9050818103602083015261305a8185612c61565b9050818103604083015261306e8184612bf7565b9050949350505050565b6000602082019050818103600083015261309181612dbe565b9050919050565b600060208201905081810360008301526130b181612e64565b9050919050565b600060208201905081810360008301526130d181612ef0565b9050919050565b60006020820190506130ed6000830184612f30565b92915050565b600061016082019050613109600083018e612f30565b818103602083015261311b818d612bf7565b9050818103604083015261312f818c612bf7565b90508181036060830152613143818b612bf7565b90508181036080830152613157818a612bf7565b905081810360a083015261316b8189612bf7565b905081810360c083015261317f8188612bf7565b905081810360e08301526131938187612bf7565b90508181036101008301526131a88186612bf7565b90508181036101208301526131bd8185612bf7565b90508181036101408301526131d28184612bf7565b90509c9b505050505050505050505050565b600060c0820190506131f96000830189612f30565b818103602083015261320b8188612bf7565b905061321a6040830187612f30565b818103606083015261322c8186612bf7565b905081810360808301526132408185612bf7565b905081810360a08301526132548184612bf7565b9050979650505050505050565b6000604051905081810181811067ffffffffffffffff8211171561328457600080fd5b8060405250919050565b600067ffffffffffffffff8211156132a557600080fd5b602082029050602081019050919050565b600067ffffffffffffffff8211156132cd57600080fd5b602082029050602081019050919050565b600067ffffffffffffffff8211156132f557600080fd5b601f19601f8301169050602081019050919050565b60008190508160005260206000209050919050565b600081519050919050565b600082825260208201905092915050565b600081905092915050565b60006133518261336e565b9050919050565b60008115159050919050565b6000819050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b82818337600083830152505050565b60005b838110156133c55780820151818401526020810190506133aa565b838111156133d4576000848401525b50505050565b6000601f19601f8301169050919050565b6133f481613346565b81146133ff57600080fd5b50565b61340b81613364565b811461341657600080fd5b50565b6134228161338e565b811461342d57600080fd5b5056fea2646970667358221220ecbf390a55f6a14c493a2b538843a56989c97f69f9c87a22982f9d296479535e64736f6c634300060c0033';
                        // create transaction object
                        const txObject = {
                            nonce : web3.utils.toHex(txCount),
                            gasLimit : "E00",//web3.utils.toHex(1000000),
                            gasPrice : web3.utils.toHex(web3.utils.toWei('10','gwei')),
                            data : data
                        } 
                        //sign the transaction
                        const tx = new ethereumjs.Tx(txObject);
                        tx.sign(privateKey1);

                       
                        
                        const serializedTx = tx.serialize();
                        const raw = '0x'+ serializedTx.toString('hex');

                        //Broadcast the transaction
                        web3.eth.sendSignedTransaction(raw)
                        .then(async(receipt) =>{
                            console.log("Contract address : " + receipt.contractAddress);
                            window.contract = await loadContract(receipt.contractAddress);
                            console.log(window.contract);
                            addAddressesToWL(whitelistedAddresses);
                            setInfoAppareil();
                        });
                        
                    });
                }
        
                async function addAddressesToWL(addrList){
                    var account = await web3.eth.getAccounts();
                    account = account[0];
                    await window.contract.methods.addAddressesToWhitelist(addrList,"technicians").send({from: account});
                    await window.contract.methods.addAddressesToWhitelist(addrList,"client").send({from: account});
                }
                async function setInfoAppareil() {
                    var account = await web3.eth.getAccounts();
                    account = account[0];
                    const cat = document.getElementById('cat_select').value;
                    const a_type = document.getElementById('type_select').value;
                    const brand = document.getElementById('marque').value;
                    const ref = document.getElementById('ref').value;
                    const serial_n = document.getElementById('n_serie').value;
                     
                    console.log("cat =" + cat + ", a_type = " + a_type + ", brand= "+ brand +" ,ref = "+ ref + " ,serial_n = "+ serial_n);
                    const Appareil = await window.contract.methods.setAppareil(cat,a_type,brand,ref,serial_n).send({from: account});
                }
                
                loadWeb3();

            </script>
    



    
    </body>
</html>